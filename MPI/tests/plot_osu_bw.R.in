#!/usr/bin/Rscript --vanilla

# Parse arguments
args <- commandArgs(TRUE)
if (length(args) != 1)
{
  cat("Error: data file must be passed as the first parameter\n", file=stderr())
  quit(status=1)
}

# get input file
data_file <- args[1];


output_pdffile <- paste(data_file,".pdf",sep="")
output_pngfile <- paste(data_file,".png",sep="")


# Read data file
data <- read.table(data_file,header=T)

title <- "MPI Bandwidth - @SITE@ - @BUILDNAME@"
xlabel <- "Message Size (Bytes)"
ylabel <- "Bandwidth (MBytes/s)"


#pdf( file=output_pdffile, height=5, width=8, title=title )
png( filename=output_pngfile,height=500,width=800,units = "px")

plot( data, type="b", col="blue", lwd=1.5, log="xy", ann=FALSE)
grid( nx=NULL, ny=NULL, col="gray10", lwd=1 )

title( main=title, xlab=xlabel, ylab=ylabel)

cat('<DartMeasurementFile name="Plot" type="image/png"> ', output_pngfile, ' </DartMeasurementFile>\n')

dev.off()

